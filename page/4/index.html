<!DOCTYPE html>
<html lang="zh">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="moonrailgun" />
<meta name="description" content="一个兴趣使然的软件攻城狮的个人博客。兴趣是最好的老师。"/>
<script async defer data-website-id="be33e45e-5666-46a7-8080-e9e2be720b72" src="https://umami.moonrailgun.com/script.js"></script>
<script async defer src="https://tianji.moonrailgun.com/tracker.js" data-website-id="clp2l64d2435nmm5dcfc6hcoz"></script>


    
    


<meta property="og:type" content="website">
<meta property="og:title" content="moonrailgun - 兴趣使然的工程师 — 个人技术展示">
<meta property="og:url" content="http://www.moonrailgun.com/page/4/index.html">
<meta property="og:site_name" content="moonrailgun - 兴趣使然的工程师 — 个人技术展示">
<meta property="og:locale">
<meta property="article:author" content="moonrailgun">
<meta name="twitter:card" content="summary">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="moonrailgun - 兴趣使然的工程师 — 个人技术展示" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">





    <link href="https://lib.baomitu.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="https://lib.baomitu.com/pace/1.0.2/pace.min.js"></script>
    <link href="https://lib.baomitu.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">



<link rel="stylesheet" href="/css/style.css">




<link href="https://lib.baomitu.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>moonrailgun - 兴趣使然的工程师 — 个人技术展示</title>

<script src="https://lib.baomitu.com/jquery/2.2.4/jquery.min.js"></script>
<script src="https://lib.baomitu.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: false,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "https://lib.baomitu.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "https://lib.baomitu.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






<!-- plausible.io -->
<script defer data-domain="moonrailgun.com" src="https://plausible.io/js/script.file-downloads.hash.outbound-links.pageview-props.revenue.tagged-events.js"></script>
<script>window.plausible = window.plausible || function() { (window.plausible.q = window.plausible.q || []).push(arguments) }</script>

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/"></a></h1>
        </hgroup>

        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/show/">作品展示</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:moonrailgun@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" rel="noopener" href="https://github.com/moonrailgun" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apache/" rel="tag">Apache</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Apicloud/" rel="tag">Apicloud</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Blender/" rel="tag">Blender</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CCLog/" rel="tag">CCLog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CORS/" rel="tag">CORS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSLoader/" rel="tag">CSLoader</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ES6/" rel="tag">ES6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GMT/" rel="tag">GMT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Garfish/" rel="tag">Garfish</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Github/" rel="tag">Github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Github-Action/" rel="tag">Github Action</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML5/" rel="tag">HTML5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTPS/" rel="tag">HTTPS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LINK1104/" rel="tag">LINK1104</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MMD/" rel="tag">MMD</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MikuMikuCombat/" rel="tag">MikuMikuCombat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NSURL/" rel="tag">NSURL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeJS/" rel="tag">NodeJS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OOM-Killer/" rel="tag">OOM Killer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PHP/" rel="tag">PHP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React-Query/" rel="tag">React Query</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ReactNative/" rel="tag">ReactNative</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ref/" rel="tag">Ref</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSL/" rel="tag">SSL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Session/" rel="tag">Session</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shader/" rel="tag">Shader</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Snowpack/" rel="tag">Snowpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Steam/" rel="tag">Steam</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swap/" rel="tag">Swap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TRPG/" rel="tag">TRPG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TRPG-Engine/" rel="tag">TRPG Engine</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tailchat/" rel="tag">Tailchat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TexturePacker/" rel="tag">TexturePacker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu-18-04/" rel="tag">Ubuntu 18.04</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unicode/" rel="tag">Unicode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity/" rel="tag">Unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unreal/" rel="tag">Unreal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/" rel="tag">Vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Weex/" rel="tag">Weex</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WhiteWord/" rel="tag">WhiteWord</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/adb/" rel="tag">adb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/atom/" rel="tag">atom</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auth/" rel="tag">auth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/autorelease/" rel="tag">autorelease</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blender/" rel="tag">blender</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/" rel="tag">c++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/callback/" rel="tag">callback</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/centos7/" rel="tag">centos7</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cherry-pick/" rel="tag">cherry-pick</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chrome/" rel="tag">chrome</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/chromium/" rel="tag">chromium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cluster/" rel="tag">cluster</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cocoapods/" rel="tag">cocoapods</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cocos2dx/" rel="tag">cocos2dx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/commonjs/" rel="tag">commonjs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cookie/" rel="tag">cookie</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cycle/" rel="tag">cycle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debounce/" rel="tag">debounce</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/" rel="tag">devops</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docusaurus/" rel="tag">docusaurus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docusaurus-v2/" rel="tag">docusaurus v2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/esmodule/" rel="tag">esmodule</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/extensions/" rel="tag">extensions</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/firefox/" rel="tag">firefox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gcc/" rel="tag">gcc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gradient/" rel="tag">gradient</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gulp/" rel="tag">gulp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hao360/" rel="tag">hao360</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/" rel="tag">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/" rel="tag">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ionic/" rel="tag">ionic</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/" rel="tag">ios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k3s/" rel="tag">k3s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/" rel="tag">lambda表达式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/libcocos2d-2013-lib/" rel="tag">libcocos2d_2013.lib</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lodash/" rel="tag">lodash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/meta-program/" rel="tag">meta program</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mini-star/" rel="tag">mini-star</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node/" rel="tag">node</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/node-orm/" rel="tag">node-orm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nox/" rel="tag">nox</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/npm/" rel="tag">npm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/objective-c/" rel="tag">objective-c</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ohmyzsh/" rel="tag">ohmyzsh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pod/" rel="tag">pod</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pomelo/" rel="tag">pomelo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pubg/" rel="tag">pubg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-virtualized/" rel="tag">react-virtualized</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/requirejs/" rel="tag">requirejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rfc/" rel="tag">rfc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/safari/" rel="tag">safari</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sequelizejs/" rel="tag">sequelizejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/session/" rel="tag">session</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssl/" rel="tag">ssl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stacking-context/" rel="tag">stacking context</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sticky/" rel="tag">sticky</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svg/" rel="tag">svg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swarm/" rel="tag">swarm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/swift/" rel="tag">swift</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tailwindcss/" rel="tag">tailwindcss</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/throttle/" rel="tag">throttle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/traefik/" rel="tag">traefik</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unity/" rel="tag">unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/upyun/" rel="tag">upyun</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/utf-8/" rel="tag">utf-8</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vercel/" rel="tag">vercel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/" rel="tag">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vmware/" rel="tag">vmware</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack-dev-server/" rel="tag">webpack-dev-server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack-stats-viewer/" rel="tag">webpack-stats-viewer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/weixin/" rel="tag">weixin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wsl/" rel="tag">wsl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wsl2/" rel="tag">wsl2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/z-index/" rel="tag">z-index</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/zustand/" rel="tag">zustand</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%A7%E7%A0%94%E6%95%88%E8%83%BD/" rel="tag">产研效能</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E4%BB%93%E5%BA%93/" rel="tag">代码仓库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96/" rel="tag">代码优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8E%E5%8F%B0/" rel="tag">后台</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A3%81%E7%BA%B8/" rel="tag">壁纸</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%97%E8%8A%82%E8%B7%B3%E5%8A%A8/" rel="tag">字节跳动</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%88%E6%9C%9B%E5%85%88%E9%94%8B/" rel="tag">守望先锋</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%85%A8/" rel="tag">安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">工程化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B8%B8%E7%94%A8%E6%8A%80%E5%B7%A7/" rel="tag">常用技巧</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/" rel="tag">开发笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E4%BF%A1/" rel="tag">微信</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E5%86%85%E6%A0%B8/" rel="tag">微内核</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BE%AE%E5%89%8D%E7%AB%AF/" rel="tag">微前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%BF%AB%E6%8D%B7%E6%96%B9%E5%BC%8F/" rel="tag">快捷方式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" rel="tag">性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8/" rel="tag">持久化存储</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%91%87%E6%A0%91%E4%BC%98%E5%8C%96/" rel="tag">摇树优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag">数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%96%87%E6%A1%A3/" rel="tag">文档</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F/" rel="tag">时间格式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag">服务器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98/" rel="tag">每日一题</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B3%A8%E5%86%8C%E8%A1%A8/" rel="tag">注册表</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%B2%E6%9F%93/" rel="tag">渲染</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/" rel="tag">游戏开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81%E5%AE%9A%E4%BD%8D/" rel="tag">源码定位</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" rel="tag">源码解析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%88%B6%E5%AD%90%E5%85%B3%E7%B3%BB/" rel="tag">父子关系</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%89%88%E6%9C%AC%E5%8F%B7/" rel="tag">版本号</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86/" rel="tag">状态管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%AB%99%E5%8A%AB%E6%8C%81/" rel="tag">网站劫持</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag">网络</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%83%A1%E8%A8%80%E4%B9%B1%E8%AF%AD/" rel="tag">胡言乱语</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%93%9D%E5%9B%BE/" rel="tag">蓝图</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B7%A8%E5%9F%9F/" rel="tag">跨域</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B7%A8%E5%B9%B3%E5%8F%B0/" rel="tag">跨平台</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%B8%A9%E5%9D%91/" rel="tag">踩坑</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%92%93%E9%B1%BC%E7%BD%91%E7%AB%99/" rel="tag">钓鱼网站</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%97%AD%E5%8C%85/" rel="tag">闭包</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9B%86%E7%BE%A4/" rel="tag">集群</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/" rel="tag">静态网站</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95/" rel="tag">面试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/" rel="tag">项目管理</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://github.com/msgbyte/tailchat">Tailchat</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">一个兴趣使然的程序员 上海,上班族,27岁. 熟练掌握Nodejs, Html5, C Sharp, Unity技术</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页"></a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页"></a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/show/">作品展示</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:moonrailgun@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/moonrailgun" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-如何开发与坚持维护一个企业级的开源项目" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/posts/28f21ef5/" class="article-date">
      <time datetime="2020-12-14T07:03:11.000Z" itemprop="datePublished">2020-12-14</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/posts/28f21ef5/">如何开发与坚持维护一个企业级的开源项目</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><a target="_blank" rel="noopener" href="https://github.com/TRPGEngine/Client">TRPG Engine</a> 是我一直坚持维护的一个开源项目。正如所有的开源项目都起源于开发者的兴趣，<code>TRPG Engine</code>也是我对于跑团这一小众领域的兴趣。</p>
<p>我在没有支援没有赞助，单凭个人爱好独立坚持开发3年以上不间断。前端代码累计提交2700+, 后端代码累计提交1200+，风雨无阻。</p>
<p>谨以此文，分享一下我维护这个开源项目的经历。并与千千万万独立坚持的开源人共勉。</p>
<h2 id="起初"><a href="#起初" class="headerlink" title="起初"></a>起初</h2><p>所有的个人项目都起源于想做。因为我想做，因此我建立了这样的项目。最初的目的很单纯，就是作为我学习React的一个实践。</p>
<p>最初选用的技术栈是<code>React</code> + <code>Redux</code>。之所以用<code>React</code>是为了可以共享一部分的代码到<code>React Native</code>, 这样的搭配会很大的减少重复逻辑的开发与后期的维护，以减少成本。</p>
<blockquote>
<p>而事实是我在两者共存与中间代码上花费了很多的精力，写了很多中间脚本使网页版与RN版能够相互协作。</p>
</blockquote>
<h2 id="明确定位"><a href="#明确定位" class="headerlink" title="明确定位"></a>明确定位</h2><p>一个项目，如果要走的长远，必须明确你的产品定位与目标用户。比如同样作为即时通讯应用, 钉钉瞄准的用户群是上班族，slack的用户群是开发者，discord的目标用户是游戏玩家，而qq的用户群是小学生。以此为原点，钉钉开发出了一系列日历，考勤，协同，已读未读，ding等功能。slack只做了大量机器人，discord专注于语音会话与大用户群组聊天，而qq则整出了很多花样。</p>
<p>明确自己的定位，其目标一定是解决某种痛点与缺陷，做出任何的抉择都需要考虑是不是符合自己的定位。一个明确的定位可以帮助你不会花费无意义的时间在没有收益的功能上。</p>
<h2 id="时刻保持热情与思考"><a href="#时刻保持热情与思考" class="headerlink" title="时刻保持热情与思考"></a>时刻保持热情与思考</h2><p>时刻记住，项目是为自己做的。它不是一种谋生工具，而是一种兴趣爱好。它最初应当起源于你对现状的小小不满，终止于对此兴趣的终止。不妨增加一些筹码：比如它可以作为你的游戏场，比如他可以作为你谋求更高事业渠道的凭证，比如他可以是你与你伴侣之间的小小私人空间，比如你可以这样告诉自己，你的每一行代码都有可能帮助到素未蒙面的陌生人，而他会感谢你的无私付出。这些会帮助你时刻保持热情与动力，而不至于让这个项目半途而废。</p>
<h2 id="维护自己的门面"><a href="#维护自己的门面" class="headerlink" title="维护自己的门面"></a>维护自己的门面</h2><p>如果一个项目想要宣传，一个门面则非常重要。这可能是一个README, 一片文章，一个官网。但是如果没有任何说明，告诉别人这是什么，你在做什么。又能期待谁来阅读你的源码呢？</p>
<h2 id="自己是第一用户"><a href="#自己是第一用户" class="headerlink" title="自己是第一用户"></a>自己是第一用户</h2><p>对于个人项目来说，自己才是自己产品最忠实的用户，只有这样才能不断发掘产品的不足，并不断改善。如果自己都不想用自己的产品，那么这个产品还有存在的必要么？</p>
<h2 id="开发"><a href="#开发" class="headerlink" title="开发"></a>开发</h2><p>回到技术细节:</p>
<p>因为技术在不断更新。而有的库又逐步步入生命周期的终结，很多情况不得不花费时间去迁移。</p>
<p>而<code>TRPG Engine</code>经历过几次大的迁移/迭代:</p>
<ul>
<li>原来<code>TRPG Engine</code>的后端是使用的<a target="_blank" rel="noopener" href="https://github.com/dresende/node-orm2">node-orm2</a>. 然后这个库被弃用了。因此花了很大经历将其迁移到<a target="_blank" rel="noopener" href="https://github.com/sequelize/sequelize">sequelize</a>，包括代码的修改与数据库的变更。这个没什么好分享的，纯粹是当时的选择有限，而库的生命周期比较短。</li>
<li>最早的<code>TRPG Engine</code>使用的是用纯粹的js写的，但是随着业务的不断增多，代码复杂度的变高，我选择使用<a target="_blank" rel="noopener" href="https://www.typescriptlang.org/">Typescript</a>对我的项目进行重构。从长远来看这一步是非常值得的，TS的类型系统长远的帮助到了一个项目的健康发展。（其实有点小遗憾，从目前的角度来看flow在一些细节做得比ts更加好）。</li>
<li>从<code>React ClassComponent</code> 到 <code>React Hooks</code>: hooks无疑拥有更高的抽象性，使用Hooks能抛弃HOC这种很难被typescript支持的写法。同时更方便代码的复用，特别是对于React和React Native代码并存的项目来说。</li>
<li>前端重构, 重写界面。原来的TRPG Engine是参考的钉钉设计的，但实际的迭代中，频道的需求更为突出。即需要由原来的单层消息列表变成双层消息列表。因此花费了几个月时间写了一版类似于<code>Discord</code>设计的新版页面，并且颜色也从原来的亮色变成保护眼睛的暗色。</li>
</ul>
<h3 id="善用单元测试"><a href="#善用单元测试" class="headerlink" title="善用单元测试"></a>善用单元测试</h3><p>为了一个项目的长远发展，测试用例与持续集成都是必要的。特别是单元测试，在很多时候能帮助到项目的提前预知问题。坚持每个bug都有一个对应的单元测试用例，防止再次出现类似的问题。</p>
<p><code>TRPG Engine</code> 虽然开始写测试用例比较晚，但是一旦有机会就会补充一些测试用例，以防止出现一些边缘问题。</p>
<p>目前<code>TRPG Engine</code>前端有223个测试用例，后端有284个测试用例，还远远不够一个项目的健康发展。</p>
<h3 id="学会数据迁移"><a href="#学会数据迁移" class="headerlink" title="学会数据迁移"></a>学会数据迁移</h3><p>为了方便数据库的升级，自己fork了一个<a target="_blank" rel="noopener" href="https://github.com/TRPGEngine/sequelize-auto-migrations">sequelize-auto-migrations</a>库用于生成数据库的迁移脚本, 因为原作者已经不维护了。</p>
<p>数据库迁移脚本可以保证在任意环境下都能生成正确的数据库格式。这对于关系型数据库来说非常重要。</p>
<h3 id="兴趣是原始驱动力"><a href="#兴趣是原始驱动力" class="headerlink" title="兴趣是原始驱动力"></a>兴趣是原始驱动力</h3><p>与商业项目不同的是，个人项目可以把一切自己感兴趣、想做的东西都想办法以某种形式糅合到自己的项目中。</p>
<p><code>TRPG Engine</code>就拥有这些有意思的系统:</p>
<ul>
<li>基于xml描述与js沙盒的动态计算的表单系统</li>
<li>基于<a target="_blank" rel="noopener" href="https://github.com/ianstormtaylor/slate">slate</a>实现的笔记系统与富文本输入框</li>
<li>基于meta信息的动态面板</li>
<li>基于BBCode的消息解释器</li>
</ul>
<h2 id="运维"><a href="#运维" class="headerlink" title="运维"></a>运维</h2><p>为了维护与运营这个项目，唯一的支出就是在服务器和OSS上了，零零散散也花费了几千元在上面了。一台2核4G的主服务器, 在主服务器上运行Mysql, Redis与Mysql。另外还有一台1核1G的小型服务器作为语音服务器与测试服务器。前端的代码都是本地编译好后提交到第三方对象存储上，这样用户的访问会更加迅速与快捷。</p>
<h2 id="赞助"><a href="#赞助" class="headerlink" title="赞助?"></a>赞助?</h2><p>曾经也考虑过要不要和别人一样放出二维码，看看能不能获得一些打赏，后来想了想还是算了。一方面没有多少的关注，我本人也比较低调不善于宣传。另一方面感觉，掺杂了利益后的开源项目，总感觉失去了纯粹性。爱好只能是爱好，如果成为一种牟利方式，那么可能就不像当初那么纯粹了。</p>
<h2 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h2><p>最后感谢所有开源作者的无私奉献，正是你们存在才能让这个互联网世界变得更加精彩。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-从 Webpack 到 Snowpack, 编译速度提升十倍以上——TRPG Engine迁移小记" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/posts/74598ef5/" class="article-date">
      <time datetime="2020-10-17T11:41:35.000Z" itemprop="datePublished">2020-10-17</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/posts/74598ef5/">从 Webpack 到 Snowpack, 编译速度提升十倍以上——TRPG Engine迁移小记</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h2><p><a target="_blank" rel="noopener" href="https://github.com/TRPGEngine/Client"><code>TRPG Engine</code></a>经过长久以来的迭代，项目已经显得非常臃肿了。数分钟的全量编译, 每次按下保存都会触发一次<strong>10s</strong>到<strong>1m</strong>不等的增量编译让我苦不堪言, 庞大的依赖使其每一次编译都会涉及很多文件和很多包，长时的编译时间大大降低了开发效率与迭代速度。</p>
<h2 id="优化方式"><a href="#优化方式" class="headerlink" title="优化方式"></a>优化方式</h2><p>经过一段时间的考察，我选择了<a target="_blank" rel="noopener" href="https://www.snowpack.dev/"><code>Snowpack</code></a>作为解决方案。与<code>Webpack</code>不同的是，除了第一次的全量编译以外，<code>Snowpack</code>的增量编译不会涉及到庞大的<code>node_modules</code>文件夹, 准确来说只会编译变更文件本身。甚至于如果没有对依赖进行变更，下次的全量编译会直接动用之前编译的文件缓存，不需要花时间等待<code>node_modules</code>的编译。</p>
<p>为什么会这么快？这是由于<code>Snowpack</code>本身的实现与设计哲学有关的。相比<code>Webpack</code>, <code>Snowpack</code>利用了现代浏览器的本身的<code>module</code>系统，跳过复杂的模型之间的组织编译过程而只关注于变更文件本身的编译，这样当然快了。</p>
<p>拿<code>Snowpack</code>官方的一张图来说:</p>
<p><img src="/images/snowpack/1.png"></p>
<p><code>snowpack</code>的最小编译单位是文件，而<code>webpack</code>的最小编译单位为<code>chunk</code>, 而<code>chunk</code>还需要额外的计算, 不论是编译部分还是编译后的组装部分。snowpack的设计逻辑天生决定了她的速度。</p>
<p><strong>优化前(使用<code>webpack</code>):</strong></p>
<p>全量编译:</p>
<p><img src="/images/snowpack/2.jpg"></p>
<p>增量编译:</p>
<p><img src="/images/snowpack/3.jpg"></p>
<p>全量请求用时:</p>
<p><img src="/images/snowpack/6.jpg"></p>
<p><strong>优化后(使用<code>snowpack</code>):</strong></p>
<p>全量编译:</p>
<p><img src="/images/snowpack/4.jpg"></p>
<p>增量编译:</p>
<p><img src="/images/snowpack/5.jpg"></p>
<p>(看不到编译用时，但是体感在1s内. 而且该效果在电脑运行其他应用时更加显著)</p>
<p>全量请求用时:</p>
<ul>
<li><p>使用http1<br><img src="/images/snowpack/7.jpg"></p>
</li>
<li><p>使用http2<br><img src="/images/snowpack/8.jpg"></p>
</li>
</ul>
<p><em>以上测试是保证电脑在空闲时间，且保存与操作内容为同一文件</em></p>
<p><em>该用时已经是平时操作的最快时间，为此我的MBR重启了一次强制清空了swap空间, 实际表现会更加显著</em></p>
<p><em>因为文件依赖于浏览器的耗时，而浏览器需要串行请求依赖，因此耗时会更加长</em></p>
<p><em>但实际使用中使用snowpack会更加优秀。因为其相比webpack会大大节约电脑资源。在webpack编译时会占用大量的电脑资源，会影响到其他操作</em></p>
<h2 id="遇到的坑与解决方案"><a href="#遇到的坑与解决方案" class="headerlink" title="遇到的坑与解决方案"></a>遇到的坑与解决方案</h2><p><code>TRPG Engine</code>算是非常经典的<code>Webpack</code>应用了, 使用了各种Loader。光通用配置就有250+行，各种优化配置，各种 alias。等等长时间迭代积攒下来的配置，因此毫不意外的会遇到很多问题与坑。</p>
<p>以下是我遇到的问题与解决方案:</p>
<ul>
<li>问题1:<ul>
<li>入口文件使用的是<a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/html-webpack-plugin/">HtmlwebpackPlugin</a>编译的<code>handlebars</code>文件，而snowpack不支持<code>handlebars</code>文件作为入口</li>
<li>解决方案：重写一个<code>snowpack</code>专用的入口文件。使用<code>handlebars</code>主要解决的是dll的问题，<code>snowpack</code>不需要处理这部分的优化因此直接跳过</li>
</ul>
</li>
<li>问题2:<ul>
<li><code>snowpack</code>加载文件策略与node不同。有同名文件和文件夹会优先使用文件夹的index.js作为路径解析。具体看现象可以参考这个讨论: <a target="_blank" rel="noopener" href="https://github.com/snowpackjs/snowpack/discussions/1320">https://github.com/snowpackjs/snowpack/discussions/1320</a></li>
<li>解决方案：改名字，让文件夹与文件名不会出现重复。包括同名但是大小写不同的问题，因为底层是<code>node</code>的<code>fs.stat</code>实现，在大小写敏感的系统下依旧会视为同名</li>
</ul>
</li>
<li>问题3:<ul>
<li><code>TRPG Engine</code>不但有web端，还有<code>react-native</code>端，而<code>react-native</code>是无法被正常解析的。我只想要处理web端的开发环境使用<code>snowpack</code>优化开发体验</li>
<li>解决方案: <code>exclude</code>配置手动过滤</li>
</ul>
</li>
<li>问题4:<ul>
<li>tspath不支持，虽然有了<code>@snowpack/plugin-typescript</code>但是不支持tspath。</li>
<li>解决方案: 手动写了一个自动解析的逻辑将其变成对应的<a target="_blank" rel="noopener" href="https://www.snowpack.dev/#import-aliases">alias</a>加到配置上</li>
</ul>
</li>
<li>问题5:<ul>
<li>在css中引入了字体文件，但是无法正常加载。因为snowpack无法正确识别url指定的资源并将其打包(webpack是使用<code>css-loader</code>来实现的)</li>
<li>解决方案:<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scripts: &#123;</span><br><span class="line">  <span class="symbol">&#x27;mount</span>:font&#x27;: <span class="symbol">&#x27;mount</span> src/web/assets/fonts --to /main/fonts&#x27;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>问题6:<ul>
<li>对于一些特殊的写法我不想影响webpack的实现但是<code>snowpack</code>不支持这种写法。比如使用<a target="_blank" rel="noopener" href="https://webpack.js.org/configuration/externals/"><code>externals</code></a>实现的配置引入, 比如<a target="_blank" rel="noopener" href="https://webpack.js.org/plugins/define-plugin/">DefinePlugin</a>实现的<code>process.env</code>(在snowpack中必须使用<a target="_blank" rel="noopener" href="https://www.snowpack.dev/#environment-variables"><code>import.meta.env</code></a>), 再比如<code>require</code>的使用</li>
<li>解决方案: 我实现了一个<a target="_blank" rel="noopener" href="https://github.com/moonrailgun/snowpack-plugin-replace">snowpack-plugin-replace</a>插件用于将这些东西全部替换成我想要的代码。具体使用如下:<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  <span class="string">&#x27;snowpack-plugin-replace&#x27;</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    list: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">from</span>: <span class="regexp">/process\.env/g</span>,</span><br><span class="line">        to: <span class="string">&#x27;import.meta.env&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">from</span>: <span class="string">`require(&quot;../../package.json&quot;).version`</span>,</span><br><span class="line">        to: <span class="string">&#x27;&quot;0.0.0&quot;&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">from</span>: <span class="string">`const resBundle = require(&quot;i18next-resource-store-loader!./langs/index.js&quot;);`</span>,</span><br><span class="line">        to: <span class="string">&#x27;import resBundle from &quot;./langs/zh-CN/translation.json&quot;&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">from</span>: <span class="string">&#x27;import Config from &quot;config&quot;;&#x27;</span>,</span><br><span class="line">        to: <span class="string">`const Config = <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(&#123;</span></span></span><br><span class="line"><span class="string"><span class="subst">          sentry: <span class="built_in">require</span>(<span class="string">&#x27;config&#x27;</span>).get(<span class="string">&#x27;sentry&#x27;</span>),</span></span></span><br><span class="line"><span class="string"><span class="subst">        &#125;)&#125;</span>;`</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>问题7:<ul>
<li>rollup抛出无法解析<code>this</code>的警告</li>
<li>解决方案: 使用context指向window来移除警告<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">installOptions</span>: &#123;</span><br><span class="line">  <span class="attribute">rollup</span>: &#123;</span><br><span class="line">    context: <span class="string">&#x27;window&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>问题8:<ul>
<li>snowpack打包目标路径与原有的build文件夹冲突</li>
<li>解决方案: 修改输出目录为<code>.snowpack</code>并在gitignore中添加该文件夹<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">devOptions</span>: &#123;</span><br><span class="line">  <span class="attribute">out</span>: <span class="string">&#x27;.snowpack&#x27;</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>问题9:<ul>
<li>使用<code>@snowpack/plugin-typescript</code>内部包对全局变量的声明会出现重复声明的报错</li>
<li>解决方案: <code>tsconfig</code>的<code>&quot;skipLibCheck&quot;: true</code></li>
</ul>
</li>
<li>问题10:<ul>
<li>现有的依赖需要<code>@babel/plugin-transform-runtime</code>提供的<code>helpers</code>作为全局依赖</li>
<li>解决方案: 经检查是用到了<code>regenerator</code>功能，手动安装<code>regenerator-runtime</code>并在包前引入<code>import &#39;regenerator-runtime/runtime&#39;;</code></li>
</ul>
</li>
<li>问题11:<ul>
<li>部分依赖在其中部分代码使用了<code>行内require</code>作为引入方式, 而<code>snowpack</code>无法正确处理<code>行内require</code></li>
<li>解决方案: 检查后发现都已经修改。升级依赖到最新版即可<ul>
<li>PS: 顶部require snowpack使用rollup的commonjs插件来解决，具体看代码:<a target="_blank" rel="noopener" href="https://github.com/snowpackjs/snowpack/blob/d90a1fb8a080bfe32e7283d87063381cd97f48bb/esinstall/src/index.ts#L383-L387">https://github.com/snowpackjs/snowpack/blob/d90a1fb8a080bfe32e7283d87063381cd97f48bb/esinstall/src/index.ts#L383-L387</a></li>
</ul>
</li>
</ul>
</li>
<li>问题12:<ul>
<li>在使用less的import逻辑无法正常运行，这是由于<code>snowpack</code>的具体实现决定的。</li>
<li><del>暂时无法解决，使用<code>snowpack-plugin-replace</code>将其替换为css文件导入作为临时解决方案, 见讨论: <a target="_blank" rel="noopener" href="https://github.com/snowpackjs/snowpack/discussions/1360">Github</a></del> 使用<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@snowpack/plugin-run-script"><code>@snowpack/plugin-run-script</code></a>插件将其手动编译后放在公共文件中。可以参考这个<a target="_blank" rel="noopener" href="https://github.com/TRPGEngine/Client/commit/8c39dd9fbcf7bbad4bee93c7760d0b2b4415cbdf">commit</a></li>
</ul>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Snowpack虽然作为一个新兴的打包工具，目前尚不是非常完善, 功能也没有webpack这样丰富与齐全。但是它的新的打包设计对于有一定规模的前端应用还是非常优秀的。能极大提升开发效率。不失为一种好的解决方案。当然最后输出还是需要使用webpack对其进行一定的优化，毕竟原生的module支持目前浏览器的支持度还没有达到覆盖一个理想的地步<a target="_blank" rel="noopener" href="https://caniuse.com/es6-module">https://caniuse.com/es6-module</a></p>
<p>最后这是我最后提交的<a target="_blank" rel="noopener" href="https://github.com/TRPGEngine/Client/pull/88/files">pr</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Snowpack/" rel="tag">Snowpack</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TRPG-Engine/" rel="tag">TRPG Engine</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webpack/" rel="tag">Webpack</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-TRPG Engine —— 一个功能完善即时通讯系统" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/posts/191d7ea8/" class="article-date">
      <time datetime="2020-09-25T15:51:35.000Z" itemprop="datePublished">2020-09-25</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/posts/191d7ea8/">TRPG Engine —— 一个功能完善即时通讯解决方案</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="项目背景"><a href="#项目背景" class="headerlink" title="项目背景"></a>项目背景</h2><p>除了传统的聊天软件，还有为固定需求打造的定位其他的聊天软件</p>
<p>比如钉钉立足于工作流，slack专注于程序员之间的项目沟通。而<code>TRPG Engine</code>就是一款为了小众的跑团玩家所打造的通用即时通讯解决方案</p>
<h2 id="项目亮点"><a href="#项目亮点" class="headerlink" title="项目亮点"></a>项目亮点</h2><ul>
<li>基于XML描述的人物卡系统(可以理解为动态表单) - <a target="_blank" rel="noopener" href="https://trpg.moonrailgun.com/playground">Playground</a></li>
<li>Web端与RN端共享redux状态的实践与工具链</li>
<li>多端并存与代码共享(Web端, RN端, Portal端 <em>(Portal端是RN端通过webview进行一部分中间操作的方式，类似于各种手机App的H5端)</em> )</li>
<li>其他的一些自研实用工具，如<code>RN端WEB端通用Portal组件</code>, <code>快速生成通用表单</code>, <code>基于BBCode的消息解释器</code>, <code>通用缓存管理机制</code></li>
<li>工程化代码，可拓展性强</li>
<li>移动端兼容与PWA</li>
</ul>
<h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><ul>
<li>MySql 5.7+</li>
<li>Redis</li>
</ul>
<h2 id="功能列表"><a href="#功能列表" class="headerlink" title="功能列表"></a>功能列表</h2><h4 id="通用功能"><a href="#通用功能" class="headerlink" title="通用功能"></a>通用功能</h4><ul>
<li>用户登入登出</li>
<li>用户注册</li>
<li>私聊/群聊</li>
<li>头像上传与裁剪</li>
<li>用户设置</li>
<li>好友管理<ul>
<li>好友发送邀请/同意邀请</li>
</ul>
</li>
<li>基于BBCode的消息解析器<ul>
<li>url内容</li>
<li>图片内容</li>
<li>@提及</li>
</ul>
</li>
<li>多种消息类型<ul>
<li>通用消息</li>
<li>提示消息</li>
<li>卡片消息</li>
</ul>
</li>
<li>消息回复与消息撤回</li>
<li>自动抓取消息内的网址的预览信息</li>
<li>基于slate的富文本编辑器</li>
<li>消息通知<ul>
<li>移动端基于<code>upush</code>。包括本地进程未被杀死的本地推送与本地被杀死后的upush推送</li>
</ul>
</li>
<li>多种文件管理策略<ul>
<li>头像上传七牛云或本地</li>
<li>聊天图片使用外置图片服务转发到第三方图床</li>
<li>聊天文件存储在本地，定时删除</li>
</ul>
</li>
<li>单向聊天消息机器人</li>
<li>群组多面板<ul>
<li>多面板类型: 目前有笔记面板与文字频道</li>
<li>面板的编辑/删除/拖拽排序</li>
</ul>
</li>
<li>app热更新与apk更新<ul>
<li>热更新基于自部署的<code>codepush</code>服务器, apk更新会自动获取最新的apk版本</li>
</ul>
</li>
<li>app下载管理</li>
<li>多国语言(中英, 尚未完全覆盖)</li>
</ul>
<h4 id="跑团相关"><a href="#跑团相关" class="headerlink" title="跑团相关"></a>跑团相关</h4><ul>
<li>基于Slate的笔记系统</li>
<li>人物卡系统<ul>
<li>基于XML的布局描述与内置JS沙盒解释器来解释js脚本</li>
<li>人物卡的切换与切换时发送消息变换头像与名字</li>
<li>人物卡分享与Fork</li>
</ul>
</li>
<li>投骰表达式与消息拦截器</li>
<li>输入时向所有人发送输入状态</li>
<li>在线招募系统</li>
</ul>
<h4 id="线上监控"><a href="#线上监控" class="headerlink" title="线上监控"></a>线上监控</h4><ul>
<li>计划任务记录</li>
<li>接口耗时统计</li>
<li>请求限流</li>
<li>系统日志: 日志会被转发到<code>loggly</code>或本地记录。其他的操作相关会存储到数据库<ul>
<li>用户登录记录</li>
<li>机器人记录</li>
<li>投骰记录</li>
<li>oss文件记录</li>
</ul>
</li>
<li>登录/注册统计汇总</li>
<li>前端后端错误汇报</li>
</ul>
<h2 id="项目规模"><a href="#项目规模" class="headerlink" title="项目规模"></a>项目规模</h2><ul>
<li>开发时间: 3年</li>
<li>所用数据表: 61张</li>
<li>功能完整的多端:<ul>
<li>两版网页端</li>
<li>基于React Native的安卓端</li>
</ul>
</li>
</ul>
<h2 id="预览"><a href="#预览" class="headerlink" title="预览"></a>预览</h2><p><img src="https://i.loli.net/2020/09/18/IdQJskawY9mC1RG.png"></p>
<p>在线地址: <a target="_blank" rel="noopener" href="https://trpg.moonrailgun.com/">https://trpg.moonrailgun.com/</a><br>开源地址: <a target="_blank" rel="noopener" href="https://github.com/TRPGEngine/Client">https://github.com/TRPGEngine/Client</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/typescript/" rel="tag">typescript</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-React 注意事项" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/posts/80587f52/" class="article-date">
      <time datetime="2020-09-09T08:17:17.000Z" itemprop="datePublished">2020-09-09</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/posts/80587f52/">React 注意事项</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="Inline-Style-内联样式"><a href="#Inline-Style-内联样式" class="headerlink" title="Inline Style 内联样式"></a>Inline Style 内联样式</h2><p>内联样式有一些简写操作</p>
<p>比如:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&#123;&#123;<span class="attr">height</span>: <span class="number">10</span>&#125;&#125;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>转化为</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;height: 10px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>在jsx中会自动加上px单位。但需要注意的是, 并不是每种属性都会自动加上单位的。容易出问题的比如<code>lineHeight</code></p>
<p>这里有一个列表，以下属性不会自动加上px</p>
<ul>
<li>animationIterationCount</li>
<li>boxFlex</li>
<li>boxFlexGroup</li>
<li>boxOrdinalGroup</li>
<li>columnCount</li>
<li>fillOpacity</li>
<li>flex</li>
<li>flexGrow</li>
<li>flexPositive</li>
<li>flexShrink</li>
<li>flexNegative</li>
<li>flexOrder</li>
<li>fontWeight</li>
<li>lineClamp</li>
<li>lineHeight</li>
<li>opacity</li>
<li>order</li>
<li>orphans</li>
<li>stopOpacity</li>
<li>strokeDashoffset</li>
<li>strokeOpacity</li>
<li>strokeWidth</li>
<li>tabSize</li>
<li>widows</li>
<li>zIndex</li>
<li>zoom</li>
</ul>
<p>参考文章: <a target="_blank" rel="noopener" href="https://react-cn.github.io/react/tips/style-props-value-px.html">Shorthand for Specifying Pixel Values in style props</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-又拍云整站网页存放到OSS的解决方案" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/posts/c09e1fbc/" class="article-date">
      <time datetime="2020-08-29T16:06:11.000Z" itemprop="datePublished">2020-08-30</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/posts/c09e1fbc/">又拍云整站网页存放到OSS的解决方案</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>前后端分离后允许前端页面静态访问，因此整站放到OSS上成为可能</p>
<p>但是有一个问题就是要如何实现原来单页应用上刷新页面无法获取到正确的网页文件的问题</p>
<p>该问题在nginx上的解决方案是这样的:</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">location</span> <span class="title">/ &#123;</span></span><br><span class="line"><span class="title">  try_files</span> $uri /index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>又拍云边缘规则编程模式下配置规则</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$WHEN($NOT($MATCH($_URI,<span class="string">&#x27;[\\.]&#x27;</span>)))/index.html</span><br></pre></td></tr></table></figure>
<p>表示所有连接都返回根目录的<code>index.html</code>文件</p>
<h2 id="更加复杂的场景"><a href="#更加复杂的场景" class="headerlink" title="更加复杂的场景"></a>更加复杂的场景</h2><p>对于实际场景中，可能有多个应用并存，比如我的TRPG Engine中就有多个单页应用存在一个域名下</p>
<p>三个应用:</p>
<ul>
<li>/index.html 主应用</li>
<li>/playground/index.html playground页，只有一个页面</li>
<li>/portal/index.html portal页, 会有多个页面存在</li>
</ul>
<p>我给出配置如下:</p>
<p>优先级1: playground <strong>break</strong></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$WHEN</span>(<span class="variable">$EQ</span>(<span class="variable">$_URI</span>,<span class="string">&#x27;/playground&#x27;</span>))<span class="regexp">/playground/i</span>ndex.html</span><br></pre></td></tr></table></figure>

<p>优先级2: portal <strong>break</strong></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$WHEN</span>(<span class="variable">$ALL</span>(<span class="variable">$MATCH</span>(<span class="variable">$_URI</span>,<span class="string">&#x27;^/portal&#x27;</span>),<span class="variable">$NOT</span>(<span class="variable">$MATCH</span>(<span class="variable">$_URI</span>,<span class="string">&#x27;[\\.]&#x27;</span>))))<span class="regexp">/portal/i</span>ndex.html</span><br></pre></td></tr></table></figure>

<p>优先级3: 单页应用</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$WHEN($NOT($MATCH($_URI,<span class="string">&#x27;[\\.]&#x27;</span>)))/index.html</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其中<code>break</code>的意思是满足一个条件则不会继续往下匹配</p>
</blockquote>
<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p>参考链接: <a target="_blank" rel="noopener" href="https://cnodejs.org/topic/5badd93037a6965f59051d40">https://cnodejs.org/topic/5badd93037a6965f59051d40</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/upyun/" rel="tag">upyun</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-记一次重启网络服务后网络不通的调试" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/posts/bdc192d2/" class="article-date">
      <time datetime="2020-07-22T02:11:27.000Z" itemprop="datePublished">2020-07-22</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/posts/bdc192d2/">记一次重启网络服务后网络不通的调试</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>我的网络服务端是用docker搭建的Nginx服务器。在一次重启网络服务<code>service network restart</code>后监控机器人告知服务挂了。检查以后发现服务可以ping通，查询日志无异常，docker服务反复重启也无法使其正常生效。考虑到使用的是弹性公网会不会是虚拟网络之间的问题，经排查后也不存在该问题。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>在google找方案的时候受到启发，输入<code>netstat -tunlp</code>检查监听端口。果然没有只有一条<code>tcp6 :::80</code>的监听而没有应当有的<code>0.0.0.0:80</code>的监听。那么问题就出在端口方面，而我docker的状态明明写的是<code>0.0.0.0:80-&gt;80/tcp</code>啊，为什么会没有监听ipv4的端口？</p>
<p>为使其能够正常运行。编辑<code>/etc/sysctl.conf</code>加上一条以开启ipv4转发</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">net</span>.ipv<span class="number">4</span>.ip_forward=<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>如果改行已存在则直接修改.</p>
<p>成功后输入<code>sysctl -p</code>检查变更已成功应用。</p>
<p>无需重启即可生效，检查后发现网络服务已恢复正常</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-让Chrome显示完整网址" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/posts/ed7510e5/" class="article-date">
      <time datetime="2020-07-20T09:01:48.000Z" itemprop="datePublished">2020-07-20</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/posts/ed7510e5/">让Chrome显示完整网址</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>Chrome 76+版本以后默认隐藏 <code>https://</code> , <code>www</code>等<em>无关紧要</em>的标识符</p>
<p>作为开发者，这些信息是非常有价值的。因此需要手动再将其重新开启</p>
<h3 id="在flags页面中将其重新开启"><a href="#在flags页面中将其重新开启" class="headerlink" title="在flags页面中将其重新开启"></a>在flags页面中将其重新开启</h3><p>地址栏<code>chrome://flags</code>, 进入flags页面</p>
<h4 id="Chrome-版本小于83"><a href="#Chrome-版本小于83" class="headerlink" title="Chrome 版本小于83"></a>Chrome 版本小于83</h4><p>将<code>Omnibox UI Hide Steay-State URL Scheme and Trivial Subdomains</code>设置为禁用</p>
<h4 id="Chrome-版本大于等于83"><a href="#Chrome-版本大于等于83" class="headerlink" title="Chrome 版本大于等于83"></a>Chrome 版本大于等于83</h4><p>将<code>Context menu show full URLs</code>设置为启用, 并右键地址栏选中<code>总是显示完整网址</code></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/chrome/" rel="tag">chrome</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-adb devices无法获取夜神模拟器的解决方案" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/posts/86a1d2a7/" class="article-date">
      <time datetime="2020-05-30T07:21:06.000Z" itemprop="datePublished">2020-05-30</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/posts/86a1d2a7/">adb devices无法获取夜神模拟器的解决方案</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>在开启模拟器的前提下。在终端输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ adb devices</span><br></pre></td></tr></table></figure>

<p>如果没有看到夜神模拟器的设备。则将<code>$&#123;ANDROID_HOME&#125;/platform-tools/adb.exe</code>复制并覆盖夜神模拟器根目录下的<code>adb.exe</code>与<code>nox_adb.exe</code>。</p>
<p>重启后查看效果(重启前确保后台的<code>adb.exe</code>与<code>nox_adb.exe</code>进程已被关闭)</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/adb/" rel="tag">adb</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nox/" rel="tag">nox</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-新服务器必做二三事" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/posts/303de4fd/" class="article-date">
      <time datetime="2020-05-21T14:47:37.000Z" itemprop="datePublished">2020-05-21</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/posts/303de4fd/">新服务器必做二三事</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>主要是给自己一个提醒。一个新服务器需要做哪些必备项目</p>
<h3 id="增加新用户用于常用用户"><a href="#增加新用户用于常用用户" class="headerlink" title="增加新用户用于常用用户"></a>增加新用户用于常用用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ useradd xxxx</span><br><span class="line">$ passwd xxx</span><br></pre></td></tr></table></figure>

<h3 id="切换到用户-设置为秘钥登录"><a href="#切换到用户-设置为秘钥登录" class="headerlink" title="切换到用户 设置为秘钥登录"></a>切换到用户 设置为秘钥登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ su xxx</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~</span><br><span class="line">$ mkdir .ssh</span><br><span class="line">$ chmod 700 .ssh</span><br><span class="line">$ vim authorized_keys <span class="comment"># 插入登录公钥</span></span><br><span class="line">$ chmod 600 authorized_keys</span><br></pre></td></tr></table></figure>

<h3 id="关闭密码登录和root用户登录-仅允许密码登录"><a href="#关闭密码登录和root用户登录-仅允许密码登录" class="headerlink" title="关闭密码登录和root用户登录 仅允许密码登录"></a>关闭密码登录和root用户登录 仅允许密码登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">exit</span> <span class="comment"># 退出到root用户</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/ssh/sshd_config</span><br><span class="line">$ service sshd restart</span><br></pre></td></tr></table></figure>

<p><strong>设定以下参数:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin no # 不允许root用户直接登录</span><br><span class="line">PasswordAuthentication no # 不允许通过密码登录(即仅允许秘钥登录)</span><br></pre></td></tr></table></figure>



<h2 id="可选项目"><a href="#可选项目" class="headerlink" title="可选项目"></a>可选项目</h2><h3 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/hostname</span><br><span class="line">$ hostname $(cat /etc/hostname)</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag">服务器</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-快速构建软件文档——docusaurus v2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/posts/856c955/" class="article-date">
      <time datetime="2020-04-15T01:13:23.000Z" itemprop="datePublished">2020-04-15</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/posts/856c955/">快速构建软件文档——docusaurus v2</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>来源是想要给我的应用做一个首页。需要有文档、首页两项。如果文档中能插入一些比较复杂的内容(如在线预览)这样的功能的话就更好了</p>
<p>开始使用的是<code>docusaurus v1</code>, 后来发现他无法在markdown文档中插入<code>iframe</code>。 会触发一个诡异的bug，导致渲染中断，无法正常渲染后面的内容，因此就中断了。后来发现<code>docusaurus</code>开始开发了v2版。虽然处于Beta阶段但还是能进行初步的使用了。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://v2.docusaurus.io/">docusaurus v2官方文档</a></li>
</ul>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul>
<li>docusaurus v2.0.0-alpha.50</li>
</ul>
<h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul>
<li>使用React开发。可以体会到现代语言的优势。</li>
<li>内置文档、博客，集成<a target="_blank" rel="noopener" href="https://community.algolia.com/docsearch/">Algolia DocSearch</a>。开箱即用。</li>
<li>完全可定制的组件和样式, 增加完全的可定制化能力</li>
<li>MDX实现。在Markdown中也能使用React组件</li>
</ul>
<h2 id="自定义独立页面"><a href="#自定义独立页面" class="headerlink" title="自定义独立页面"></a>自定义独立页面</h2><p>略过初始化内容。我们直接进入自定义的阶段。</p>
<p>docusaurus 的独立页面在<code>src/pages</code>文件夹中, 就和写React组件一样我们可以利用React很轻松的构建属于自己的页面, 首页就是index.js。</p>
<p>对于非模板化的页面。比如首页、showcase、问卷调查这些，都可以通过独立页面来实现。</p>
<h2 id="自定义渲染组件"><a href="#自定义渲染组件" class="headerlink" title="自定义渲染组件"></a>自定义渲染组件</h2><p>docusaurus 提供了很强的自定义能力，使用<code>@theme/*</code>引用组件。提供一套预设的组件用于渲染网站的各个部位。其内容在<a target="_blank" rel="noopener" href="https://github.com/facebook/docusaurus/tree/master/packages/docusaurus-theme-classic">https://github.com/facebook/docusaurus/tree/master/packages/docusaurus-theme-classic</a></p>
<p>对于该项目中的每一个组件，我们都能进行定制。使用<code>docusaurus swizzle &lt;theme name&gt; [component name]</code>命令将样式包中的组件复制到自己的<code>src/theme</code>文件夹中。可以指定的替换相应组件的实现</p>
<p>如:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run swizzle @docusaurus/theme-classic Footer</span><br></pre></td></tr></table></figure>

<p>来重写页脚。</p>
<p><code>@theme/*</code> 引用会以此查找本地的<code>src/theme</code>文件夹的组件，主题包里的组件。</p>
<h2 id="自定义markdown渲染"><a href="#自定义markdown渲染" class="headerlink" title="自定义markdown渲染"></a>自定义markdown渲染</h2><p>Markdown是我们写文档重要的工具，有时候Markdown基本的语法无法满足我们的需要，此时就可以自己编写渲染逻辑。这样在不丧失Markdown简洁的前提下给予我们文档更加强大的表现力</p>
<p>比如我就自己写了一个组件, 用于将代码与预览相互转化: <a target="_blank" rel="noopener" href="https://github.com/TRPGEngine/Server/blob/master/services/Website/website/src/plugins/remark-template-previewer.js">https://github.com/TRPGEngine/Server/blob/master/services/Website/website/src/plugins/remark-template-previewer.js</a></p>
<p>当然还有一种方法是利用MDX的特性在Markdown中引用React组件</p>
<h2 id="成果"><a href="#成果" class="headerlink" title="成果"></a>成果</h2><ul>
<li><a target="_blank" rel="noopener" href="https://trpgdoc.moonrailgun.com/">https://trpgdoc.moonrailgun.com/</a></li>
</ul>
<p>更多<code>docusaurus</code>的特性请查阅<a target="_blank" rel="noopener" href="https://v2.docusaurus.io/">官方文档</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docusaurus/" rel="tag">docusaurus</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docusaurus-v2/" rel="tag">docusaurus v2</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%96%87%E6%A1%A3/" rel="tag">文档</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9D%99%E6%80%81%E7%BD%91%E7%AB%99/" rel="tag">静态网站</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/3/">Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/5/">Next</a>
    </nav>
  

</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i>
                2016-2024 moonrailgun
                | <a target="_blank" href="https://beian.miit.gov.cn/">沪ICP备19001187号-1</a>
                | <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=31011302006539">
                    <img src="/img/beian.png"/>
                    <span>沪公网安备 31011302006539号</span>
                  </a>
                | <a title="本网站由又拍云提供CDN加速/云存储服务" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank" rel="noopener noreferrer"><img src="/img/upyun_logo.png" height="18" style="vertical-align: bottom;" /></a>
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    
<script data-main="/js/main.js" src="https://lib.baomitu.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<!-- <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"> -->
<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  </div>
</body>
</html>